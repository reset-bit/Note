[toc]
# 计算机网络基础知识快速复习
## 为什么要了解计算机网络相关知识
主要应用在发送请求request和接收返回response时。包括状态码、缓存、请求头、跨域、cookie等。

## 网络层次划分
### TCP/IP 4层模型
应用层-传输层-网络层-网络接口层，根据计算机网络运行模式总结而出
### TCP/IP 5层模型
应用层-传输层-网络层-【数据链路层、物理层】，目前应用最广泛的模型
### OSI 7层模型
【应用层、表示层、会话层】-传输层-网络层-【数据链路层-物理层】，理论推导模型

## 1.物理层
与传输媒体的接口，完成传输媒体上的信号与二进制数据间的转换；定义接口的机械特性【引线数目和排列】、电气特性【信号编码方式】、功能【电压意义】和过程【事件出现顺序】特性等。
### 香农定理
在噪声信道中，当带宽为H Hz，信噪比为S/N，最大数据传输速率（b/s）=`Hlog2(1+S/N)`
### 信道工作方式
单工（单向传输）、半双工（双方都可以接收或发送，但不能同时进行）、全双工（双方可以同时接收或发送）
### 信道复用
时分复用、波分复用、码分复用
### 交换技术
电路交换（数据传输前建立端到端通路，建立连接后通路被独占）、报文交换（全部存储后转发）、分组交换（将报文划分为若干定长分组，每个分组包含目的地址，单个分组存储转发）

## 2.数据链路层
提供点到点的链路，封装数据成帧、帧同步、透明传输【不论所传数据是什么比特组合，总能传输】、差错控制（多少错）
### 交换机
每个接口都直接与主机相连，一般都工作在全双工模式。每一对相互通信的主机都能像独占通信媒体哪样，进行无碰撞的传输数据。
### MAC层
MAC地址48位
#### 帧格式
目的地址-源地址-类型-数据-FCS
#### 帧定界
面向字符填充、面向二进制位填充（01111110）
帧头+信息+校验信息；帧数据部分长度上限MTU
#### 帧校验
检错码：校验和、循环冗余检错码CRC（基本思想是将传输数据当做一个位数很长的数，将这个数除以另一个数，将得到的余数【FSC帧检验序列】附加在原数据后面。此处除法是模二除法：原始数据补0，进行除法操作，但加减法使用异或代替。接收方将帧除以与发送方相同的数，结果为0无差错==》奇偶校验是CRC特例）
#### 载波监听、多点接入、冲突检测协议 CSMA/CD
以太网MAC子层协议，适用广播信道
载波监听：每一个站在发送数据之前都要检测一下总线上是否有其他计算机在发送数据。
冲突检测：最先发送数据帧的站，在发送数据帧后之多经过2倍的端到端时延【争用期】就可知道发送的数据帧是否遭受了碰撞。没有碰撞则可以发送，否则使用截断二进制指数退避算法延时发送。
> 局域网：采用某种局域网LAN技术（如以太网）构建的网络，地理范围几公里以内
> 城域网MAL；广域网WAN，划分通信子网、资源子网

#### 地址解析协议 ARP
实现同一局域网，IP地址到MAC地址的自动解析。
分为静态映射和动态映射。
动态映射过程：当主机需要找出局域网中另一主机的物理地址时，首先广播发送ARP请求报文。局域网中每一台主机都会接收并处理该报文，验证成功将会返回一个ARP报文，包含接收方IP地址和MAC地址。请求方将接收方地址映射写入自己的APR高速缓存中，为其设置生存时间，之后利用MAC地址发送单播数据帧。
若不在一个局域网，通过ARP找到一个位于本局域网上的路由器，将分组转发给路由器。由该路由器将分组转发给下一个网络。
### VLAN
虚拟局域网，每一个VLAN的帧都有一个明确的标识符，指明发送帧的工作站属于哪一个VLAN

## 3.网络层
### 路由器
每个端口可以连接不同类型网络，支持协议转换

> 路由：路由器从一个接口上收到数据包，根据数据包的目的地址进行定向并转发到另一个接口的过程。
>
> 网关：又称网间连接器，协议转换器，在网络层以上（应用层）实现网络互连，仅用于两个协议不同的网络互连。与网桥简单的转换信息不同，网关对收到的信息要重新打包，以适应目的系统的需求。
>
> 网关能在不同协议间移动数据，路由器是在不同网络间移动数据。路由器的角色之一是充当网关。

#### 路由表
目的主机IP，子网掩码，下一跳地址（判断是否直接交付）
静态路由：人工在路由器上配置路由表
动态路由：由动态路由协议自动建立并维护路由表
缺省/缺省路由：人工配置。凡是在路由表中无法查到的目标网络，在路由表中明确指定一个出口。
#### 路由协议
RIP协议：采用距离矢量路由算法，传输层为UDP。与【相邻节点】之间交换自己的路由信息，从而得到新的路由表，跳数最多为15。“坏消息传播的慢”。

![RIP协议的缺点：坏消息传播得慢](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91c2VyLWltYWdlcy5naXRodWJ1c2VyY29udGVudC5jb20vMjYzMjQzNTUvNTA3MzExMjktMjA4ODEwODAtMTE5OC0xMWU5LTg4ZDctNjI4NGViNWQ1Yjk3LmpwZw?x-oss-process=image/format,png)

OSPF协议：一个自治系统AS由一组路由器组成，AS间使用相同的路由选择协议交换信息。AS下分若干区域，【区域内路由器】交换所有信息，对其他区域则隐藏拓扑结构。当链路状态发生变化时，才向所有路由器洪泛法（路由器通过所有端口向所有相邻路由器发信息，相邻路由器重复此操作，但不再发送给刚刚发来信息的那个路由器）发送信息。

#### 分组转发算法
提取目的主机IP地址D，得出目的网络地址为N。若N与此路由器直接相连【D与本网络子网掩码相与】，则直接交付；若路由表中有目的地址为D的特定主机路由【D逐项与路由表子网掩码相与】，则交付指定的下一跳路由器；若路由表中有默认路由，则转发默认路由。否则报告转发分组出错。
### IP协议
首部（固定部分：版本、首部长度、区分服务、总长度、标识【数据报计数器】、标志【是否分片+ +允许分片】、片偏移【分片后偏移量】、生存时间【可通过的路由器个数最大值】、协议【TCP/UDP/ICMP/OSPF】、首部检验和【接收方全加结果为0正确】、源地址、目的地址；可变部分：可选字段、填充）即包头+数据
#### IP地址
32位，点分十进制表示。不使用硬件地址进行通信：网络各样，硬件地址各样。
分类：ABC单址传输地址、D多址传输地址、E保留使用

<img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210801162123091.png" alt="image-20210801162123091" style="zoom: 80%;" />


![image-20210801161902710](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20210801161902710.png)

节约IP地址：子网划分（允许在内部将一个网络分成若干子网，而对外仍像一个网络。子网间数据传输需要经过路由器。子网掩码：确定一个IP地址所对应的网络号）、CIDR无类域间路由+路由聚合（以可变长分块方式分配所剩C类网络，将若干C类连续C类地址捆绑成一个地址，作为一个分配单元。多个匹配结果选择具有最长网络前缀的路由）
### 虚拟专用网 VPN
采用隧道技术，网路只有用户需要时才通过身份验证建立+利用公众网络设施构成的私有专用网。
### 网络地址转换 NAT
内部使用私有地址，访问Internet时进行网络地址转换，把私有地址转换成公开IP地址。
分静态转换、动态转换（多内部IP+范围外部IP）。实现方式：端口多路复用（为不同主机分配不同IP地址端口号）。
### Internet控制报文协议 ICMP
当IP包无法传输时，提供报告，帮助发送方了解无法传递的原因。
IP数据报封装：首部+ICMP报文（类型【超时、不可达...】、代码、检验和、ICMP数据部分==》出错IP报文的首部+前8字节）

## 4.传输层
### 端口号
16位，应用层各种协议进程与运输实体进行层间交互的一种地址，只具有本地意义。
### 用户数据报协议 UDP
面向报文，传送数据前不需要先建立连接；接收方收到报文后不需要给出任何确认，即不提供可靠交付=尽最大努力交付；没有拥塞控制；首部8字节，开销小（TCP首部20字节）。
首部：伪首部（源IP+目的IP+0+17+UDP长度）、源端口、目的端口、长度、检验和
> 伪首部的添加仅仅是为了计算检验和
> DNS（域名解析协议） / TFTP（简单文件传输协议）

### 传输控制协议 TCP
面向字节流，传送数据前要建立连接，不提供广播或多播服务，全双工可靠交付但开销大。
连接端点称套接字，端口号拼接到IP地址即构成套接字。
首部：源端口、目的端口、序号【本报文段所发送数据第一个字节的序号】、确认号【期望收到对方的下一个报文段数据的第一个字节的序号】、数据偏移【首部长度，单位32位字】、保留、[URG【紧急】+ACK【确认】+PSH【推动】+RST【复位】+SYN【同步】+FIN【终止】]、窗口【对方设置发送窗口的依据】、检验和【加12字节伪首部】、紧急指针【紧急数据的长度】、选项、填充
> FTP（文件传输协议） / Telnet（远程登录协议，常用于测试网络及端口占用情况） / HTTP（超文本传输协议）

#### 连续自动重传请求协议 ARQ
位于发送窗口内的分组可以连续发送，无需等待对方确认；发送方每收到一个确认，发送窗口向前滑动一个分组位置；接收方一般采用累计确认的方式；发送窗口内序号用完但没有收到确认，必须停止发送；接收方接收数据不一定按序
#### 滑动窗口+超时重传+流量控制+拥塞控制
超时重传：TCP每发送一个报文段，就对这个报文段设置一次计时器。只要计时器设置的重传时间到但没有收到确认，就要重传这一报文段。
流量控制：TCP为每一个连接设置计数器，只要连接一方收到对方的零窗口通知，就启动持续计时器。计时器到期时，对方在确认探测报文段时给出当前窗口值。若窗口不是0，则开始传输报文。
拥塞控制：对资源需求的总和>可用资源。抑制发送端发送数据的速率，以便使接收端来得及接收。
> 慢开始【动态拥塞窗口，每收到一个确认就倍数增长】、拥塞避免【设置门限变量，只要网络拥塞，慢开始门限就设置为出现拥塞时的发送窗口1/2，拥塞窗口设为1并执行慢开始算法。否则+1】、快重传【接收方每收到一个失序报文段就立即发出重复确认，发送方只要连续收到3个重复确认就立即重传丢失报文】、快恢复【拥塞窗口设为慢开始门限减半后的数值并执行加法增大】；
> 随机早期检测 RED：设置队列长度最小门限和最大门限，将介于二者之间的长度的数据报，按某一概率随机丢弃

#### 三次握手--建立连接
A发送请求报文【SYN=1，序号seq=x】，B发送同意建立连接报文【SYN=1，ACK=1，期望序号ack=x+1，seq=y】，A发送确认连接报文【ACK=1，ack=y+1】
> 发送方再次发送确认报文的必要性：如果没有再确认报文，接收方将误认为已经失效的连接请求报文仍然有效，在发出应答报文后建立连接，浪费资源

#### 四次挥手--释放连接
A发送请求报文【FIN=1，seq=u】，B发送同意取消连接报文【ack=u+1，此时TCP处于半关闭状态，B仍能向A发送数据】，B发送取消连接报文，A发送确认取消连接报文【ACK=1】，A等待2MSL（最大报文寿命）后释放TCP连接
> A等待2MSL时间的必要性：**保证A发送的最后一个确认报文能够到达B。**若报文丢失，则A能够在2MSL内收到B的超时重传报文，从而再次发送确认取消连接报文；任何报文都受MSL限制，超过这个时间报文将被丢弃。**使本次连接中产生的所有报文段都从网络中消失**，保证下一次连接不会出现旧的连接请求报文段。

## 5.应用层
### 域名系统 DNS
将URL转换为IP地址
### 动态主机设置协议 DHCP
给主机自动分配IP地址，作为中央管理的手段
### 超文本传输协议 HTTP
#### 请求分类

- GET 请求读取URL所标志的信息；
- POST 给服务器添加信息；
- PUT 在给定的URL下存储文档；
- DELETE 删除给定URL所标志的资源；
- HEAD 获取报头；
- CONNECT 连接改为管道方式；
- OPTIONS 客户端查看服务器性能；
- TRACE 回显服务器收到的请求，主要用于测试或判断；
- PATCH 对PUT的补充，对已知资源进行局部更新

> GET和POST联系与区别：
>
> 二者本质都是HTTP协议中发送请求的方法。
>
> 1. GET建议从服务器获取数据；POST建议向服务器提交资源
> 2. GET是把参数数据队列加到表单ACTION所指向的URL中，信息在URL中能够看到，放在请求头内；POST不能看到，放在请求体内
> 3. GET传送数据量小，浏览器对URL的限制不能大于2KB；POST传送数据量较大，一般认为不受限制
> 4. GET只能进行URL编码（`name/value`参数编码，本质是字符串ASCII编码的16进制）；POST支持多种编码方式
> 5. GET产生的URL地址可以被`bookmark`；POST不可以
> 6. GET在浏览器回退时无害；POST会再次提交

#### 版本
##### HTTP 1.0

第一个在通讯中指定版本号的HTTP协议版本，在代理服务器中仍广泛采用。

为了提高系统效率，规定**浏览器与服务器只保持短暂的连接**。即浏览器每次请求都要需服务器建立一个TCP连接，服务器完成请求处理后立即断开TCP连接。

由于客户端是依据域名来向服务器建立连接，一般PC端浏览器会针对单个域名的server同时建立6～8个连接，手机端的连接数则一般控制在4～6个。**连接无法复用**导致每次都要经历三次握手和慢启动，相应对高延迟场景与大文件影响较大。**`head of line blocking`队头阻塞**（由于FIFO先进先出的工作机制，若某一个任务耗时过长，会阻碍其后的任务推进）导致带宽无法被充分利用。

##### HTTP 1.1

支持持久连接，在一个TCP连接上可以传送多个HTTP请求和响应。客户端可以不用等待请求结果返回就可以发出下一次请求，但服务器端必须根据收到的请求报文顺序进行响应。

另外HTTP1.1与HTTP1.0的区别还体现在：**缓存处理；安全性及完整性、互联网地址维护**等等。

常见请求方式与状态码为HTTP1.1。

##### HTTP 2.0

现今通用的协议标准。客户端首先发送`client hello`的包，若不支持2.0，仍然使用1.1

特性：

**多路复用**：在HTTP1.1中，浏览器客户端在同一时间内，针对同一域名下的请求有一定数量限制，超过限制数目会阻塞（一些站点会有多个**静态资源CDN域名**的原因之一）。HTTP2.0允许同时通过单一的HTTP2.0连接发起多重请求-响应消息，**将多个资源分别放在不同的域名服务器下**，多流并行的实现双向交换消息

**二进制分帧**：在应用层和传输层之间增加一个二进制分帧层，在不改动HTTP1.x的状态码、首部字段等情况下，将所有传输的消息分成更小的消息和帧，并采用二进制编码，首部信息封装到`HEADER frame`，`Request Body`封装到`DATA frame`。提升传输性能、实现低延迟和高吞吐量

**首部压缩**：`HPACK`算法，仅发送更新字段

**服务端推送**：在客户端请求之前发送数据的机制。在HTTP2.0中，服务器可以对客户端的一个请求发送多个响应。同时，服务器推送可以缓存。如客户端请求index.html，服务器推送相关的静态文件令客户端缓存，当客户端请求这些文件时，发现已经被缓存到浏览器中了

### 超文本传输安全协议HTTPS

在HTTP的基础上加入SSL(`Secure Sockets Layer`安全套接层)，通过**非对称加密、对称加密、HASH算法等**保证了传输过程的安全性。广泛用于万维网上安全敏感的通讯，如交易支付等方面。

现在HTTPS使用的都是TLS安全传输层协议，但由于SSL出现的时间比较早，仍被现在的浏览器支持，因此SSL仍是HTTPS的代名词。

HTTPS握手过程简述：

握手期间使用密钥非对称加密，握手后传输数据对称加密，证书信息摘要算法

> 非对称加密：使用公钥私钥加密，使用另一个解密
>
> 对称加密：使用相同密钥加解密

![image-20211007151624762](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20211007151624762.png)

> 关于http明文传输，攻击者常用网络嗅探，试图从传输过程中分析出敏感数据，如管理员登录web后台的登录过程等，从而获取网站管理权限，渗透到整个服务器的权限。另外使用抓包工具，新手就有可能获取用户私密信息

# 常见状态码

```
1XX 信息性 请求正在处理
	100 继续执行请求
2XX 成功 请求处理完毕
	200 请求正常处理
	204 请求处理成功，但没有任何资源可以返回给客户端。一般在仅客户端发送信息时使用
	206 对资源某一部分的请求
3XX 重定向 需要进行附加操作以完成请求
	301 资源URL已更新，永久性重定向
	302/307 资源URL临时定位到其他位置，临时性重定向
	303 资源URL已更新，应使用GET定向获取请求资源
	304 请求资源与本地资源相同
4XX 客户端错误 服务器无法处理请求
	400 服务器无法理解客户端请求，可能存在语法错误
	401 发送的请求需要有HTTP认证
	403 权限不够，不允许访问资源，可能IP未授权，服务器拒绝访问
	404 服务器找不到请求的资源，可能路径错误、请求方式错误
5XX 服务器错误 服务器处理请求出错
	500 内部资源故障，服务器遇到未知错误，导致无法完成客户端请求
	501 客户端使用了服务器未实现的请求方法
	502 对用户请求的响应超时
	503 服务器暂时超负载或停机维护
```

# 常见端口号
最多能有65535[2^16]个端口号
```
21: FTP
23: Telnet
53: DNS
80: HTTP
443: HTTPS
1521: Oracle
3306: MySQL
5000: SQL Sever
8000: QQ
```

